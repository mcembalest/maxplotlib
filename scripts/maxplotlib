#!/bin/bash

# Check for environment variables and output directory argument
if [ -z "$SERVER_IP" ]; then
    echo "Error: SERVER_IP must be set as environment variable."
    exit 1
fi

if [ "$#" -ne 1 ]; then
    echo "Usage: $0 OUTPUT_DIR"
    exit 1
fi

OUTPUT_DIR=$1

# Ensure the output directory exists
mkdir -p "${OUTPUT_DIR}"

# Perform the operation
curl -s -X POST http://${SERVER_IP}:8000/plot/ -F "prompt=write python to plot a circle" -o "${OUTPUT_DIR}/response.json"
jq -r '.image' "${OUTPUT_DIR}/response.json" | base64 --decode > "${OUTPUT_DIR}/output.png"

echo "Image saved in '${OUTPUT_DIR}/'"
